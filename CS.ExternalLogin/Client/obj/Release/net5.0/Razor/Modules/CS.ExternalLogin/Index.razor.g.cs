#pragma checksum "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "9acb20cbfc441dde811a4ee269ef63c96eaba488"
// <auto-generated/>
#pragma warning disable 1591
namespace CS.ExternalLogin
{
    #line hidden
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using System;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using System.Collections.Generic;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Microsoft.Extensions.Localization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Modules;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Modules.Controls;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Providers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Security;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Themes;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Themes.Controls;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.UI;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\_Imports.razor"
using Oqtane.Enums;

#line default
#line hidden
#nullable disable
    public partial class Index : ModuleBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#nullable restore
#line 8 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
 if (_message != string.Empty)
{

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<Oqtane.Modules.Controls.ModuleMessage>(0);
            __builder.AddAttribute(1, "Message", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#nullable restore
#line 10 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                         _message

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(2, "Type", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Oqtane.Modules.MessageType>(
#nullable restore
#line 10 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                          _type

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseComponent();
#nullable restore
#line 11 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
}

#line default
#line hidden
#nullable disable
            __builder.OpenElement(3, "div");
            __builder.AddAttribute(4, "class", "container Oqtane-Modules-Admin-Login");
            __builder.OpenElement(5, "div");
            __builder.AddAttribute(6, "class", "form-group");
            __builder.OpenElement(7, "label");
            __builder.AddAttribute(8, "for", "Username");
            __builder.AddAttribute(9, "class", "control-label");
            __builder.AddContent(10, 
#nullable restore
#line 16 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                     Localizer["Username:"]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(11, "\n        ");
            __builder.OpenElement(12, "input");
            __builder.AddAttribute(13, "type", "text");
            __builder.AddAttribute(14, "name", "Username");
            __builder.AddAttribute(15, "class", "form-control username");
            __builder.AddAttribute(16, "placeholder", "Username");
            __builder.AddAttribute(17, "id", "Username");
            __builder.AddAttribute(18, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 17 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                                                                        _username

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(19, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => _username = __value, _username));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(20, "\n    ");
            __builder.OpenElement(21, "div");
            __builder.AddAttribute(22, "class", "form-group");
            __builder.OpenElement(23, "label");
            __builder.AddAttribute(24, "for", "Password");
            __builder.AddAttribute(25, "class", "control-label");
            __builder.AddContent(26, 
#nullable restore
#line 20 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                     Localizer["Password:"]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(27, "\n        ");
            __builder.OpenElement(28, "input");
            __builder.AddAttribute(29, "type", "password");
            __builder.AddAttribute(30, "name", "Password");
            __builder.AddAttribute(31, "class", "form-control password");
            __builder.AddAttribute(32, "placeholder", "Password");
            __builder.AddAttribute(33, "id", "Password");
            __builder.AddAttribute(34, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 21 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                                                                            _password

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(35, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => _password = __value, _password));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(36, "\n    ");
            __builder.OpenElement(37, "div");
            __builder.AddAttribute(38, "class", "form-group");
            __builder.OpenElement(39, "div");
            __builder.AddAttribute(40, "class", "form-check form-check-inline");
            __builder.OpenElement(41, "label");
            __builder.AddAttribute(42, "class", "form-check-label");
            __builder.AddAttribute(43, "for", "Remember");
            __builder.AddContent(44, 
#nullable restore
#line 25 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                            Localizer["Remember Me?"]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(45, "&nbsp;\n            ");
            __builder.OpenElement(46, "input");
            __builder.AddAttribute(47, "type", "checkbox");
            __builder.AddAttribute(48, "class", "form-check-input");
            __builder.AddAttribute(49, "name", "Remember");
            __builder.AddAttribute(50, "id", "Remember");
            __builder.AddAttribute(51, "checked", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 26 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                                                    _remember

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(52, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => _remember = __value, _remember));
            __builder.SetUpdatesAttributeName("checked");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(53, "\n    ");
            __builder.OpenElement(54, "button");
            __builder.AddAttribute(55, "type", "button");
            __builder.AddAttribute(56, "class", "btn btn-primary");
            __builder.AddAttribute(57, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 29 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                            Login

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(58, 
#nullable restore
#line 29 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                                    Localizer["Login"]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(59, "\n    ");
            __builder.OpenElement(60, "button");
            __builder.AddAttribute(61, "type", "button");
            __builder.AddAttribute(62, "class", "btn btn-secondary");
            __builder.AddAttribute(63, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 30 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                              Cancel

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(64, 
#nullable restore
#line 30 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                                       Localizer["Cancel"]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(65, "\n    <br><br>\n    ");
            __builder.OpenElement(66, "button");
            __builder.AddAttribute(67, "type", "button");
            __builder.AddAttribute(68, "class", "btn btn-secondary");
            __builder.AddAttribute(69, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 32 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                              Forgot

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(70, 
#nullable restore
#line 32 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
                                                                       Localizer["Forgot Password"]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 60 "D:\Goti\CreativeSims\Demo\Oqtane\ExModule\CS.ExternalLogin\Client\Modules\CS.ExternalLogin\Index.razor"
        private string _returnUrl = string.Empty;
    private string _message = string.Empty;
    private MessageType _type = MessageType.Info;
    private string _username = string.Empty;
    private string _password = string.Empty;
    private bool _remember = false;

    public override SecurityAccessLevel SecurityAccessLevel => SecurityAccessLevel.Anonymous;

    public override List<Resource> Resources => new List<Resource>()
{
        new Resource { ResourceType = ResourceType.Stylesheet, Url = ModulePath() + "Module.css" }
    };

    protected override async Task OnInitializedAsync()
    {
        if (PageState.QueryString.ContainsKey("returnurl"))
        {
            _returnUrl = PageState.QueryString["returnurl"];
        }

        if (PageState.QueryString.ContainsKey("name"))
        {
            _username = PageState.QueryString["name"];
        }

        if (PageState.QueryString.ContainsKey("token"))
        {
            var user = new User();
            user.SiteId = PageState.Site.SiteId;
            user.Username = _username;
            user = await UserService.VerifyEmailAsync(user, PageState.QueryString["token"]);

            if (user != null)
            {
                _message = Localizer["User Account Verified Successfully. You Can Now Login With Your Username And Password Below."];
            }
            else
            {
                _message = Localizer["User Account Could Not Be Verified. Please Contact Your Administrator For Further Instructions."];
                _type = MessageType.Warning;
            }
        }
    }

    private async Task Login()
    {
        //if (PageState.Runtime == Oqtane.Shared.Runtime.Server)
        //{
        //    // server-side Blazor
        //    var user = new User();
        //    user.SiteId = PageState.Site.SiteId;
        //    user.Username = _username;
        //    user.Password = _password;
        //    user = await UserService.LoginUserAsync(user, false, false);

        //    if (user.IsAuthenticated)
        //    {
        //        await logger.LogInformation("Login Successful For Username {Username}", _username);
        //        // complete the login on the server so that the cookies are set correctly on SignalR
        //        var interop = new Interop(JSRuntime);
        //        string antiforgerytoken = await interop.GetElementByName("__RequestVerificationToken");
        //        var fields = new { __RequestVerificationToken = antiforgerytoken, username = _username, password = _password, remember = _remember, returnurl = _returnUrl };
        //        await interop.SubmitForm($"/{PageState.Alias.AliasId}/pages/login/", fields);
        //    }
        //    else
        //    {
        //        await logger.LogInformation("Login Failed For Username {Username}", _username);
        //        AddModuleMessage(Localizer["Login Failed. Please Remember That Passwords Are Case Sensitive And User Accounts Require Email Verification When They Initially Created."], MessageType.Error);
        //    }
        //}
        //else
        //{
        // client-side Blazor
        var user = new User();
        user.SiteId = PageState.Site.SiteId;
        user.Username = _username;
        user.Password = _password;
        user = await UserService.LoginUserAsync(user, true, _remember);
        if (user.IsAuthenticated)
        {
            await logger.LogInformation("Login Successful For Username {Username}", _username);
            var authstateprovider = (IdentityAuthenticationStateProvider)ServiceProvider.GetService(typeof(IdentityAuthenticationStateProvider));
            authstateprovider.NotifyAuthenticationChanged();
            NavigationManager.NavigateTo(NavigateUrl(_returnUrl, "reload"));
        }
        else
        {
            await logger.LogInformation("Login Failed For Username {Username}", _username);
            AddModuleMessage(Localizer["Login Failed. Please Remember That Passwords Are Case Sensitive And User Accounts Require Verification When They Are Initially Created So You May Wish To Check Your Email."], MessageType.Error);
        }
        //}
    }

    private void Cancel()
    {
        NavigationManager.NavigateTo(_returnUrl);
    }

    private async Task Forgot()
    {
        if (_username != string.Empty)
        {
            var user = await UserService.GetUserAsync(_username, PageState.Site.SiteId);
            if (user != null)
            {
                await UserService.ForgotPasswordAsync(user);
                _message = "Please Check The Email Address Associated To Your User Account For A Password Reset Notification";
            }
            else
            {
                _message = "User Does Not Exist";
                _type = MessageType.Warning;
            }
        }
        else
        {
            _message = "Please Enter The Username Related To Your Account And Then Select The Forgot Password Option Again";
        }

        StateHasChanged();
    } 

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IStringLocalizer<Login> Localizer { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IServiceProvider ServiceProvider { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IUserService UserService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavigationManager { get; set; }
    }
}
#pragma warning restore 1591
